---
title: 电商广告点击分析系统
tags: Flume,Kafka,SparkStreaming
grammar_cjkRuby: true
grammar_mindmap: true
renderNumberedHeading: true
---

# 核心需求

1、在线黑名单过滤
2、计算每个BatchDuration中每个User的广告点击量
3、判断用户点击是否属于黑名单点击
4、广告点击累计动态更新
5、对广告点击进行TopN
6、计算过去半个小时广告的点击趋势

# 架构选型
 假设我们的应用系统对应的用户的日活量在百万的基础上来实现此架构。


## Flume的简介
apache Flume 是一个从可以收集例如日志，事件等数据资源，并将这些数量庞大的数据从各项数据资源中集中起来存储的工具/服务，或者数集中机制。flume具有高可用，分布式，配置工具，其设计的原理也是基于将数据流，如日志数据从各种网站服务器上汇集起来存储到HDFS，HBase等集中存储器中。

![2.1 Flume复杂流结构模型](https://www.github.com/Tu-maimes/document/raw/master/小书匠/多路复杂.jpg)



### Flume的优势


1、Flume可以将应用产生的数据存储到任何集中存储器中，例如HDFS、HBase、Kafka等。
2、当收集数据的速度超过将写入数据的时候，也就是当收集信息遇到峰值时，这时候收集的信息非常大，甚至超过了系统的写入数据的能力，Flume会在数据生产者和数据收容器间做出调整，保证其能够在两者之间提供平稳的数据。
3、Flume的管道是基于事务，保证了数据在传送和接收时的一致性。
4、Flume是可靠的，容错性高，可升级，易管理，并且可定制。
5、支持各种接入资源数据的类型以及输出数据的类型。
6、支持多路径流量，多管道接入流量，多管道输出流量，上下文路由等。
7、可以被水平扩展。


### Flume性能测试

#### 测试环境

##### 硬件

- CPU：Intel(R) Core(TM) i7-6700 CPU @ 3.40GHz（8核）
- 内存：16G

##### 软件

- Flume：1.6.0
- Hadoop：2.6.0-cdh5.5.0
- Kfaka：2.11-0.9.0.1
- JDK：1.8.0_91-b14 64位

##### 测试文件

- 文件大小：107M ，共490010条记录

##### Flume配置

1、Source配置:
> agent.sources.source1.type = spooldir
> agent.sources.source1.spoolDir=/data/flume/dir

2、MemoryChannel配置
>agent.channels.memoryChannel.capacity = 1000000
agent.channels.memoryChannel.transactionCapacity = 1000000
agent.channels.memoryChannel.type=memory

3、FileChannel配置

> agent.channels.fileChannel.type = file
agent.channels.fileChannel.checkpointDir = /data/flume/checkpoint
agent.channels.fileChannel.dataDirs = /data/flume/data

4、